name: ceos
mgmt:
  network: eosnet
  ipv4-subnet: 172.80.80.0/24
topology:
  nodes:

    srlrouter:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:24.10.1
      type: ixrd3
      startup-config: configs/srlrouter.cfg    

    ceos:
      kind: arista_ceos
      image: ceos:4.34.3 
      startup-config: configs/myconfig.conf

    # TELEMETRIA STACK
    prometheus:
      kind: linux
      mgmt-ipv4: 172.80.80.42
      image: quay.io/prometheus/prometheus:v2.54.1
      binds:
        - configs/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      cmd: --config.file=/etc/prometheus/prometheus.yml
      ports:
        - 9090:9090

    grafana:
      kind: linux
      mgmt-ipv4: 172.80.80.43
      image: grafana/grafana:latest
      binds:
        - configs/grafana/datasource.yml:/etc/grafana/provisioning/datasources/datasource.yaml:ro
        - configs/grafana/dashboards.yml:/etc/grafana/provisioning/dashboards/dashboards.yaml:ro
        #- configs/grafana/dashboards:/var/lib/grafana/dashboards
      ports:
        - 3000:3000
      env:
        # GF_INSTALL_PLUGINS: "yesoreyeram-infinity-datasource"
        # env vars to enable anonymous access
        GF_ORG_ROLE: "Admin"
        GF_ORG_NAME: "Main Org"
        GF_AUTH_ANONYMOUS_ENABLED: "true"
        GF_AUTH_ANONYMOUS_ORG_ROLE: Admin
        GF_AUTH_ANONYMOUS: "true"
        GF_AUTH_OAUTH_AUTO_LOGIN: "true"
    
    gNMIc:
      kind: linux
      labels:
        graph-icon: host
      image: esanchezv/hellt-gnmic:latest
      binds:
        - configs/python_scapy.sh:/root/python_scapy.sh
        - configs/gnmic/gnmic-config.yml:/gnmic-config.yml:ro
        - configs/gnmic/gnmic-metrics.yml:/gnmic-metrics.yml:ro
        #- configs/icmpv6_capturav2.py:/root/icmpv6_capturav2.py
        #- configs/icmpv6_capturav3.py:/root/icmpv6_capturav3.py
        #- configs/supervisord.conf:/root/supervisord.conf
        #- configs/sync_bindings.py:/root/sync_bindings.py
        
      exec:
         - mkdir /data
         - chmod +x /data
         #- touch /data/mac_ipv6_bindings_dynamic.json
         - chmod +x /root/python_scapy.sh
         - bash /root/python_scapy.sh      
    
    PC1:
      kind: linux
      image: docker.io/esanchezv/kaliipv6:latest
      exec:
        - "sysctl net.ipv6.conf.eth1.addr_gen_mode=3"
        - "sysctl net.ipv6.conf.eth1.addr_gen_mode=2"
        - "sysctl net.ipv6.conf.eth1.use_tempaddr=2"  
        #- ip -6 route del default dev eth0

    PC2:
      kind: linux
      image: docker.io/esanchezv/kaliipv6:latest  
      #exec:
        #- ip -6 route del default dev eth0

    PC3:
      kind: linux
      image: docker.io/esanchezv/kaliipv6:latest  
      #exec:
        #- ip -6 route del default dev eth0    

    PC4:
      kind: linux
      image: docker.io/esanchezv/kaliipv6:latest  
      #exec:
        #- ip -6 route del default dev eth0    
      
  links:
   - endpoints: ["srlrouter:e1-1", "ceos:eth1"]  
   - endpoints: ["ceos:eth2", "gNMIc:eth1"] 
   - endpoints: ["ceos:eth3", "PC1:eth1"]   
   - endpoints: ["ceos:eth4", "PC2:eth1"]   
   - endpoints: ["ceos:eth5", "PC3:eth1"]   
   - endpoints: ["ceos:eth6", "PC4:eth1"]   
    
